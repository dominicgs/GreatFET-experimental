

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Using GreatFET APIs &mdash; GreatFET One  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/status.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Release Process" href="release_process.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> GreatFET One
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="board_naming.html">Board Naming</a></li>
<li class="toctree-l1"><a class="reference internal" href="design_neighbor.html">How to Design a Neighbor</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started_firmware_development.html">Getting Started with Firmware Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="greatfet_gnuradio.html">GreatFET and GNURadio</a></li>
<li class="toctree-l1"><a class="reference internal" href="greatfet_classes.html">GreatFET Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="greatfet_i2c.html">greatfet_i2c</a></li>
<li class="toctree-l1"><a class="reference internal" href="i2c_registry.html">I2C Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="greatfet_logic.html">greatfet_logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="indigo.html">Indigo</a></li>
<li class="toctree-l1"><a class="reference internal" href="kniphofia.html">Kniphofia</a></li>
<li class="toctree-l1"><a class="reference internal" href="libgreat_verb_signatures.html">LibGreat Verb Signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux_distribution_python_version_matrix.html">Linux Distribution Python Version Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="neighbors.html">Neighbors</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchid.html">Orchid</a></li>
<li class="toctree-l1"><a class="reference internal" href="peony.html">Peony</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_process.html">Release Process</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using GreatFET APIs</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-a-greatfet-object">Getting a GreatFET object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-apis">Using APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging">Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#led">LED</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gpio">GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="#logic-analyzer">Logic Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pattern-generator">Pattern Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uart">UART</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adc">ADC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dac">DAC</a></li>
<li class="toctree-l2"><a class="reference internal" href="#swra124-chipcon">SWRA124/Chipcon</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i2c">I²C</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GreatFET One</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Using GreatFET APIs</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/using_greatfet_apis.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-greatfet-apis">
<h1>Using GreatFET APIs<a class="headerlink" href="#using-greatfet-apis" title="Permalink to this headline">¶</a></h1>
<div class="section" id="getting-a-greatfet-object">
<h2>Getting a GreatFET object<a class="headerlink" href="#getting-a-greatfet-object" title="Permalink to this headline">¶</a></h2>
<p>A GreatFET object may be created with the following Python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">greatfet</span>

<span class="n">gf</span> <span class="o">=</span> <span class="n">greatfet</span><span class="o">.</span><span class="n">GreatFET</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">gf</span> <span class="pre">shell</span></code> will do this automatically before spawning an IPython instance. <code class="docutils literal notranslate"><span class="pre">greatfet.GreatFET()</span></code> can also take the same keyword arguments as PyUSB’s <code class="docutils literal notranslate"><span class="pre">usb.find()</span></code>, to allow specifying a device e.g. by serial number.</p>
</div>
<div class="section" id="using-apis">
<h2>Using APIs<a class="headerlink" href="#using-apis" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/greatscottgadgets/libgreat">LibGreat</a> provides the general comms API for talking to LibGreat devices.</p>
<p>Generically, APIs can be accessed in Python as <code class="docutils literal notranslate"><span class="pre">gf.apis.&lt;api_name&gt;</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">gf.apis.firmware</span></code>, for the firmware API. Alternatively, the same objects can be accessed by API names as strings via the <code class="docutils literal notranslate"><span class="pre">gf.comms.apis</span></code> dict.</p>
<p>On the command line, you can list the APIs supported by a GreatFET with <code class="docutils literal notranslate"><span class="pre">greatfet</span> <span class="pre">info</span> <span class="pre">-A</span></code>.</p>
<p>Some APIs are also additionally exposed as “interfaces” on a GreatFET object, e.g. <code class="docutils literal notranslate"><span class="pre">gf.&lt;interface&gt;</span></code>. These are primarily for convenience—they provide default configurations and simplified interfaces for their relevant APIs.</p>
<p>Some APIs also have command line tools as helpers. These will be subcommands of <code class="docutils literal notranslate"><span class="pre">greatfet</span></code> (which can be shortened to <code class="docutils literal notranslate"><span class="pre">gf</span></code>). Invoking <code class="docutils literal notranslate"><span class="pre">greatfet</span></code> without any arguments will list the currently supported subcommands.</p>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>In the event that something does not goes as expected, you can run <code class="docutils literal notranslate"><span class="pre">greatfet</span> <span class="pre">dmesg</span></code> on the command line to get a log of events that have occured on the GreatFET. From Python, you can run <code class="docutils literal notranslate"><span class="pre">gf.read_debug_ring()</span></code> to get a string object for the same text.</p>
<p>The debug ring-buffer persists across soft resets (including e.g. firmware flashes), but <em>not</em> across hard-resets, like pressing the reset button or unplugging and replugging the device.</p>
<p><code class="docutils literal notranslate"><span class="pre">gf.apis.debug.peek</span></code> and <code class="docutils literal notranslate"><span class="pre">gf.apis.debug.poke</span></code> can also be used to read from and write to raw memory addresses, for advanced debugging.</p>
</div>
<div class="section" id="led">
<h2>LED<a class="headerlink" href="#led" title="Permalink to this headline">¶</a></h2>
<p>LEDs are a simple place to start. GreatFET Azalea has 4 LEDs, though LED 1 blinks on and off periodically as a “heartbeat” by default. <em>Note that the LEDs are 1-indexed!</em></p>
<p>There is a convenience interface in Python:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>gf.leds<span class="o">[</span><span class="m">2</span><span class="o">]</span>.on<span class="o">()</span>
gf.leds<span class="o">[</span><span class="m">2</span><span class="o">]</span>.off<span class="o">()</span>
gf.leds<span class="o">[</span><span class="m">2</span><span class="o">]</span>.toggle<span class="o">()</span>
</pre></div>
</div>
<p>As well as a command-line helper tool.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ greatfet led --on <span class="m">2</span>
$ greatfet led --off <span class="m">2</span>
$ greatfet led -t <span class="m">2</span>
</pre></div>
</div>
</div>
<div class="section" id="gpio">
<h2>GPIO<a class="headerlink" href="#gpio" title="Permalink to this headline">¶</a></h2>
<p>The GPIO peripheral can be easily controlled from the convenience interface <code class="docutils literal notranslate"><span class="pre">gf.gpio</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">gf.gpio.read_pin_state((1,</span> <span class="pre">6))</span></code> will read the logic value for GPIO pin 1[6] (pin mappings for peripherals can be found <a class="reference external" href="https://gf.ktemkin.com/">temporarily here</a>) Likewise <code class="docutils literal notranslate"><span class="pre">gf.gpio.set_pin_state((1,</span> <span class="pre">6),</span> <span class="pre">0)</span></code> can be used to set the same pin to logic low.</p>
</div>
<div class="section" id="logic-analyzer">
<h2>Logic Analyzer<a class="headerlink" href="#logic-analyzer" title="Permalink to this headline">¶</a></h2>
<p>The logic analysis functionality is easiest from the command-line helper. For example:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ greatfet logic -p out.sr -f 2M -n <span class="m">4</span>
</pre></div>
</div>
<p>This will sample 4 channels at 2MSPS, and output a Sigrok-compatible file as <code class="docutils literal notranslate"><span class="pre">out.sr</span></code>.</p>
<p>The default pin mappings are as follows:</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Channel</th>
<th class="head">Pin</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>J1_P4</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>J1_P6</td>
</tr>
<tr class="row-even"><td>2</td>
<td>J1_P28</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>J1_P30</td>
</tr>
<tr class="row-even"><td>4</td>
<td>J2_P36</td>
</tr>
<tr class="row-odd"><td>5</td>
<td>J2_P34</td>
</tr>
<tr class="row-even"><td>6</td>
<td>J2_P33</td>
</tr>
<tr class="row-odd"><td>7</td>
<td>J1_P7</td>
</tr>
<tr class="row-even"><td>8</td>
<td>J1_P34</td>
</tr>
<tr class="row-odd"><td>9</td>
<td>J2_P9</td>
</tr>
<tr class="row-even"><td>10</td>
<td>J1_P25</td>
</tr>
<tr class="row-odd"><td>11</td>
<td>J1_P32</td>
</tr>
<tr class="row-even"><td>12</td>
<td>J1_P31</td>
</tr>
<tr class="row-odd"><td>13</td>
<td>J2_P3</td>
</tr>
<tr class="row-even"><td>14</td>
<td>J1_P3</td>
</tr>
<tr class="row-odd"><td>15</td>
<td>J1_P5</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pattern-generator">
<h2>Pattern Generator<a class="headerlink" href="#pattern-generator" title="Permalink to this headline">¶</a></h2>
<p>Pattern generation functionality can be done from the command-line helper. For example:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ greatfet pattern counter -n 1K -w <span class="m">8</span>
</pre></div>
</div>
<p>This will generate an 8-bit counter at 1KHz.</p>
<p>The default pin mappings are the same as the mappings for logic analysis.</p>
</div>
<div class="section" id="uart">
<h2>UART<a class="headerlink" href="#uart" title="Permalink to this headline">¶</a></h2>
<p>This class can be used to talk “serial”, and has both a command-line helper tool available and a convenience interface as <code class="docutils literal notranslate"><span class="pre">gf.uart</span></code>.</p>
<p>If you happen to have a USB-serial converter handy, then you can test it out by connecting TXD, RXD, and GND of the USB-serial converter to J1_P34, J1_P33, and any available ground pin (like J1_P1) respectively. Then you can simply run <code class="docutils literal notranslate"><span class="pre">greatfet</span> <span class="pre">uart</span></code>, and e.g. on Linux, <code class="docutils literal notranslate"><span class="pre">dterm</span> <span class="pre">/dev/ttyUSB0</span> <span class="pre">115200</span></code>. Typing in either terminal will show the respective characters on the other.</p>
<p>Naturally, all of the same functionality can be used from Python via the <code class="docutils literal notranslate"><span class="pre">uart</span></code> interface:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span> <span class="o">=</span> gf.uart.read<span class="o">()</span>
gf.uart.write<span class="o">(</span>b<span class="s2">&quot;Hello, world!&quot;</span><span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="adc">
<h2>ADC<a class="headerlink" href="#adc" title="Permalink to this headline">¶</a></h2>
<p>The analog to digital converter is easily usable from the command line helper tool. Simply running <code class="docutils literal notranslate"><span class="pre">greatfet</span> <span class="pre">adc</span></code> will print the voltage on ADC0 (mapped to J2_P5 by default).</p>
<p>In Python, there is an interface for the default ADC configuration as ADC0. To read a single sample:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>gf.adc.read_samples<span class="o">(</span><span class="m">1</span><span class="o">)</span>
</pre></div>
</div>
<p>The 10-bit digital to analog converter has a command line helper too, with <code class="docutils literal notranslate"><span class="pre">greatfet</span> <span class="pre">dac</span> <span class="pre">-S</span> <span class="pre">&lt;value&gt;</span></code>. Note that the value must be the number to set the DAC too, not a voltage. For example, <code class="docutils literal notranslate"><span class="pre">greatfet</span> <span class="pre">dac</span> <span class="pre">-S</span> <span class="pre">512</span></code> will set the DAC to ~1.6 volts.</p>
</div>
<div class="section" id="dac">
<h2>DAC<a class="headerlink" href="#dac" title="Permalink to this headline">¶</a></h2>
<p>GreatFET’s digital to analog converter is mapped to J2_P5. The API allows you to either set the raw value loaded into the DAC, or specify a target voltage (which is calculated as <code class="docutils literal notranslate"><span class="pre">value</span> <span class="pre">=</span> <span class="pre">(voltage</span> <span class="pre">*</span> <span class="pre">1024)</span> <span class="pre">/</span> <span class="pre">3.3)</span></code>. Note however that the voltage must be specified in millivolts, e.g.: <code class="docutils literal notranslate"><span class="pre">gf.apis.dac.set_voltage(int(2.5</span> <span class="pre">*</span> <span class="pre">1000))</span></code> will set the DAC voltage to 2.5.</p>
<p>The command-line helper tool can take either the raw value or a voltage:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ greatfet dac -f raw <span class="m">776</span>
$ greatfet dac <span class="m">2</span>.5
</pre></div>
</div>
<p>Both will set the DAC to ~2.5 volts.</p>
</div>
<div class="section" id="swra124-chipcon">
<h2>SWRA124/Chipcon<a class="headerlink" href="#swra124-chipcon" title="Permalink to this headline">¶</a></h2>
<p>This class is used to debug microcontrollers implementing the CC1110/CC2430/CC2510 debug interface described in SWRA124.</p>
<p>For simple dumping and flashing of firmware, it is easiest to use the command line utility:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ greatfet chipcon --read firmware.bin --length 0x8000
$ greatfet chipcon --write firmware.bin
</pre></div>
</div>
<p>The same functionality, as well as more advanced functionality, can be accessed programmatically through the Python API:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">cc</span> <span class="o">=</span> gf.create_programmer<span class="o">(</span><span class="s1">&#39;chipcon&#39;</span><span class="o">)</span>

<span class="c1"># `debug_init` must be called before any debugging can happen.</span>
cc.debug_init<span class="o">()</span>

<span class="c1"># Read the entire flash (for a 32k flash).</span>
<span class="nv">flash</span> <span class="o">=</span> cc.read_flash<span class="o">(</span><span class="nv">start_address</span><span class="o">=</span><span class="m">0</span>, <span class="nv">length</span><span class="o">=</span><span class="m">32</span> * <span class="m">1024</span><span class="o">)</span>

<span class="c1"># Reprogram the flash.</span>
cc.program_flash<span class="o">(</span>flash, <span class="nv">erase</span><span class="o">=</span>True, <span class="nv">verify</span><span class="o">=</span>True<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="section" id="i2c">
<h2>I²C<a class="headerlink" href="#i2c" title="Permalink to this headline">¶</a></h2>
<p>Class for communication over I²C buses. Can be used from Python, e.g. <code class="docutils literal notranslate"><span class="pre">gf.i2c.scan()</span></code>, or with the command-line helper, e.g. <code class="docutils literal notranslate"><span class="pre">gf</span> <span class="pre">i2c</span> <span class="pre">--scan</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="release_process.html" class="btn btn-neutral float-left" title="Release Process" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Great Scott Gadgets.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>